<!-- index.html -->
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <!-- http://www.google.com/webfonts -->
    <link href='http://fonts.googleapis.com/css?family=Lora:400,400italic,700' rel='stylesheet' type='text/css'></link>
    <title>Jesse Plymale</title>
    <!-- syntax highlighting CSS -->
    <link rel="stylesheet" href="css/syntax.css"></link>
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/main.css"></link>
    <meta name="viewport" content="width=device-width"></meta>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.2/react.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.2/react-dom.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/0.3.2/marked.min.js"></script>
  </head>
  <body>
    <div id="basePage"></div>

    <script type="text/babel">

var tableOfContents = [
  {name: 'About Me', url: 'aboutMe.markdown'},
  {name: 'Music', url: 'music.markdown'},
  {name: 'Ancient Greek', url: 'ancientGreek.markdown'},
  {name: 'Code & Career', url: 'codeAndCareer.markdown'}
];

var Nav = React.createClass({
  onNavigationItemClick(url) {
    this.props.onNavigationSelection(url);
  },

  render() {
    let tableOfContentsItems = this.props.tableOfContents.map((contentItem, i) => 
      <li key={contentItem.url}
          onClick={this.onNavigationItemClick.bind(this, contentItem.url)}>
        <span className="navItem">
          {contentItem.name}
        </span>
      </li>
    );

    return(
      <div id="nav">
        <ul>
          {tableOfContentsItems}
        </ul>
      </div>
    );
  }
});

var Content = React.createClass({
  rawMarkup() {
    return { __html: this.props.renderedMarkdownForSelectedUrl };
  },

  render() {
    return(
      <div className="content">
        <p dangerouslySetInnerHTML={this.rawMarkup()}></p>
      </div>
    );
  }
});

// tutorial1.js
var BasePage = React.createClass({
  getInitialState() {
    return {
      tableOfContents,
      renderedMarkdownForSelectedUrl: ''
    };
  },

  onNavigationSelection(selectedUrl) {
    $.ajax({
      url: selectedUrl,
      dataType: 'text',
      cache: true,
      success: (data) => {
        const HEADER_DELIM = '---';
        if(data.startsWith(HEADER_DELIM) && data.includes(HEADER_DELIM, HEADER_DELIM.length)) {
          let endOfHeader = data.indexOf(HEADER_DELIM, HEADER_DELIM.length) + HEADER_DELIM.length;
          data = data.slice(endOfHeader);
        }
        this.setState({renderedMarkdownForSelectedUrl: marked(data)});
      },
      error: (xhr, status, err) => {
        console.error(selectedUrl, status, err.toString());
      }
    });
  },

  componentDidMount() {
    this.onNavigationSelection(this.state.tableOfContents[0].url);
  },

  render: function() {
    return (
      <div id="wrapper">
        <h1 id="frontPage">{this.props.pageName}</h1>
        <div id="main">
          <Nav tableOfContents={this.state.tableOfContents}
               onNavigationSelection={this.onNavigationSelection} />
          <Content renderedMarkdownForSelectedUrl={this.state.renderedMarkdownForSelectedUrl} />
        </div>
      </div>
    );
  }
});

ReactDOM.render(
  <BasePage pageName="Jesse Plymale" />,
  document.getElementById('basePage')
);

    </script>
  </body>
</html>